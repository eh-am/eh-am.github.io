<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><style>html{display:none}</style><meta name=author content="eduardo aleixo's cafofo"><meta name=description content="eduardo aleixo's personal website"><meta name=keywords content="developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Instalando openwrt no Edge Router X"><meta name=twitter:description content="Primeiro de conversa, fui tentar acessar o annas-archive e apareceu bloqueado. Easy, basta mudar o DNS no roteador para usar o da google, CloudFare etc.
Descobri então, que o roteador da Woo (marca low budget da Nos) bloqueia as mudanças de DNS!
O que é engraçado, porque eu justamente escolhi a Woo porque tinha suporte à bridge mode, o que insinua que é mais &ldquo;aberto&rdquo; do que outros provedores, como a Vodafone, meu antigo, que não suportava bridge mode."><meta property="og:title" content="Instalando openwrt no Edge Router X"><meta property="og:description" content="Primeiro de conversa, fui tentar acessar o annas-archive e apareceu bloqueado. Easy, basta mudar o DNS no roteador para usar o da google, CloudFare etc.
Descobri então, que o roteador da Woo (marca low budget da Nos) bloqueia as mudanças de DNS!
O que é engraçado, porque eu justamente escolhi a Woo porque tinha suporte à bridge mode, o que insinua que é mais &ldquo;aberto&rdquo; do que outros provedores, como a Vodafone, meu antigo, que não suportava bridge mode."><meta property="og:type" content="article"><meta property="og:url" content="https://www.eduardoaleixo.com/posts/2025/instalando-openwrt-no-edge-router-x/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-19T11:22:08+01:00"><meta property="article:modified_time" content="2025-05-19T11:22:08+01:00"><base href=https://www.eduardoaleixo.com/posts/2025/instalando-openwrt-no-edge-router-x/><title>Instalando openwrt no Edge Router X · eduardoaleixo</title><link rel=canonical href=https://www.eduardoaleixo.com/posts/2025/instalando-openwrt-no-edge-router-x/><link rel=stylesheet href=https://www.eduardoaleixo.com/css/coder.min.0caa4ac67ec36ec2dedf930b12e60fdae22c952b84d9f102d59ced9d35491132.css integrity="sha256-DKpKxn7DbsLe35MLEuYP2uIslSuE2fEC1ZztnTVJETI=" crossorigin=anonymous media=screen><script type=text/javascript src=https://www.eduardoaleixo.com/js/script.js></script>
<script>!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!==0&&fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"eham",utcoffset:"-3"})),sessionStorage.setItem("_swa","1")</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-59191973-2","auto"),ga("send","pageview"))</script><link rel=stylesheet href=https://www.eduardoaleixo.com/scss/custom.min.4e957ed4d75934c49811ab7b910e5044ba6926a444e9f5982aa289adf6884f47.css integrity="sha256-TpV+1NdZNMSYEat7kQ5QRLppJqRE6fWYKqKJrfaIT0c=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://www.eduardoaleixo.com/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.eduardoaleixo.com/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.101.0"></head><body class=colorscheme-light><div id=page-transitioner></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.eduardoaleixo.com/>eduardoaleixo</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><div class=wrap><span class=stripe></span>
<span class=stripe></span>
<span class=stripe></span></div></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.eduardoaleixo.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://www.eduardoaleixo.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://www.eduardoaleixo.com/weekly-digest/>Weekly digest</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Instalando openwrt no Edge Router X</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i>
<time datetime=2025-05-19T11:22:08+01:00>2025/05/19</time></span>
<span class=reading-time><i class="fas fa-clock"></i>
4-minute read</span></div><div class=categories><i class="fas fa-folder"></i>
<a href=https://www.eduardoaleixo.com/categories/technical/>technical</a></div></div></header><div><p>Primeiro de conversa, fui tentar acessar o annas-archive e apareceu bloqueado.
Easy, basta mudar o DNS no roteador para usar o da google, CloudFare etc.</p><p>Descobri então, que o roteador da Woo (marca low budget da Nos) bloqueia as mudanças de DNS!</p><p>O que é engraçado, porque eu justamente escolhi a Woo porque tinha suporte à bridge mode,
o que insinua que é mais &ldquo;aberto&rdquo; do que outros provedores, como a Vodafone, meu antigo,
que não suportava bridge mode.</p><p>Ok, é possível mudar o DNS em cada device, mas dá trabalho né?</p><p>Então decidi tirar do armário um Edge Router X que havia comprado alguns anos, e usá-lo como roteador principal da rede domiciliar.</p><p>Para todos os efeitos, o Edge Router X (abreviado como <code>erx</code>) estava brickado. Talvez tenha tentado fazer algum update errado ou algo assim, então começaremos por aqui.</p><h1 id=reinstalando-o-software-de-fábrica>Reinstalando o software de fábrica</h1><p>Ele tem um sisteminha bem inteligente chamado de <a href=https://help.uisp.com/hc/en-us/articles/22591244564887-EdgeRouter-TFTP-Recovery>TFTP Recovery</a>, que basicamente é
um servidor TFTP (FTP só que via UDP), no qual você consegue subir uma imagem de recovery.</p><p>Primeiro, baixamos a imagem correta do device, no meu caso <code>ER-e50.recovery.v2.0.6.5208541.190708.0508.16de5fdde.img.signed</code>.</p><p>Ligamos um cabo de rede diretamente na <strong>porta 0</strong> do erx.</p><p>Para ativar o TFTP Recovery, desliga o roteador, depois segurando o botão de reset (com um clips ou algo similar), liga a energia e
observa as luzes até que estejam assim:</p><p><img src=https://help.uisp.com/hc/article_attachments/22591244560535 alt></p><p>Aí já pode soltar o botão de reset.</p><p>Agora, o servidor TFTP estará disponível na porta 69 do ip 192.168.1.20. Não me recordo se ele tem um servidor DHCP nele,
logo talvez seja necessário na sua máquina colocar um ip fixo, qualquer coisa na casa dos 192.168.1.x funciona.</p><p>No terminal, primeiro rode <code>tftp</code> para abrir o cliente de tftp. Então rode</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>tftp&gt; connect 192.168.1.20
</span></span><span style=display:flex><span>tftp&gt; binary
</span></span><span style=display:flex><span>tftp&gt; put ER-e50.recovery.v2.0.6.5208541.190708.0508.16de5fdde.img.signed
</span></span></code></pre></td></tr></table></div></div><p>E aguarde, após algum tempo (creio que as luzes do erx mudam quando o processo esteja terminado), e conseguirá acessar a interface via http://192.168.1.1,
caso esteja usando ip fixo, não se esqueca de mudar o gateway para 192.168.1.1</p><h1 id=instalando-openwrt>Instalando openwrt</h1><p>A tal da EdgeOS, a OS padrão do Edge Router X não me anima muito. Sei lá, achei complicado e prefiro instalar o openwrt, que é open source e managed pela comunidade.</p><p>Os passos aqui são um pouco chatos, então vamos lá:</p><p>Nesse repositório, baixe o arquivo <code>initramfs-factory.tar</code>, eu baixei o da pasta <code>Version 22.03</code></p><p>Então copie via <code>scp</code> para o erx essa imagem</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>scp -O -o HostKeyAlgorithms<span style=color:#f92672>=</span>ssh-rsa openwrt-ramips-mt7621-ubnt_edgerouter-x-initramfs-factory.tar ubnt@192.168.1.1:/tmp/
</span></span></code></pre></td></tr></table></div></div><p>Pelo meu entendimento, tive que usar <code>-o HostKeyAlgorithms=ssh-rsa</code> porque o algoritmo usado no servidor <a href=https://unix.stackexchange.com/a/682921>SSH é velho e considerado não seguro</a>,
mas como é local neste caso é ok.</p><p>Então acesse o erx via ssh e instale a imagem:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ssh ubnt@192.168.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add system image /tmp/openwrt-ramips-mt7621-ubnt_edgerouter-x-initramfs-factory.tar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></td></tr></table></div></div><p>Após reiniciar, mude o cabo de rede da porta 0 para porta 1.</p><p>De novo, creio que será necessário colocar um IP fixo, faça-o.</p><p>Agora podemos realizar um update do sistema, para tal, baixe a imagem oficial usando a página <a href=https://firmware-selector.openwrt.org/>firmware-selector</a></p><p>De novo copie usando <code>scp</code>, entre via ssh e rode:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sysupgrade -n -F /tmp/openwrt-24.10.0-ramips-mt7621-ubnt_edgerouter-x-squashfs-sysupgrade.bin
</span></span></code></pre></td></tr></table></div></div><p>Agora a LuCI (a interface) deve estar disponível na porta 192.168.1.1, e creio que também tem um DHCP server,
então um IP estático não é necessário mais.</p><h1 id=colocando-bridge-mode>Colocando bridge mode</h1><p>Provavelmente ambos os ips do roteador da Woo E do erx estão como 192.168.1.1.</p><p>Ligue o cabo de rede diretamente no roteador da Woo, então vá para 192.168.1.1 no browser, o usuário/senha padrão deve ser <code>admin/admin</code>.
Acesse Internet Conectivity, clique na aba Bridge Mode. Ou acesse diretamente o link <a href=https://192.168.1.1/2.0/gui/#/internetConnectivity/bridgemode>https://192.168.1.1/2.0/gui/#/internetConnectivity/bridgemode</a></p><p>Habilite Bridge Mode E alguma porta específica, no meu caso, usei a quarta.</p><p>Confirme. Coloque um cabo de rede entre a porta 4 do roteador da Woo e a porta 0 do erx.</p><p>Pronto! Agora todo o roteamento é feito via erx.</p><p>BTW, ele permite colocar bridge mode POR porta, para que você consiga ligar diretamente TV ou whatever sem passar por bridge mode, interessante.</p><h1 id=mudando-o-dns>Mudando o DNS</h1><p>Ligue o cabo de rede no erx. Acesse a interface do LuCI.</p><p>Aba Network -> Interfaces. Em WAN clique edit, na aba Advanced Settings há uma seção &ldquo;Use custom DNS servers&rdquo;. Coloque os
servidores DNS desejados.</p><p>(Em algum momento eu instale um unbound ou algo parecido e rode meu próprio servidor DNS, não hoje.)</p><h1 id=downsides>Downsides</h1><p>Terminado todos esses passos, vamos falar dos problemas.</p><p>O principal deles é que o Wifi do roteador da Woo ainda está ativo, portanto é possível bypassar o erx.
Deixei assim porque o router possui Wifi6, que é melhor que o Wifi5 que eu tenho e que coloquei como access point.
Idealmente você deixaria um access point com Wifi6,7 diretamente ligado no erx, e desligaria o da operadora.</p><p>Essa questão de ambos os roteadores terem o mesmo IP é levemente confuso, mas estando conectado na rede do erx seria impossível
acessar o roteador da Woo anyway, então é ok. Mas se quiser mudar o IP do erx fique à vontade.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>© 2020 - 2025
eduardo aleixo's cafofo
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><link rel=stylesheet href=https://www.eduardoaleixo.com/scss/fouc.css media=screen></body></html>